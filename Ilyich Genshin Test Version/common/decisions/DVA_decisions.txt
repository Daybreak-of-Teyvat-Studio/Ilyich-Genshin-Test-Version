@DVA_HUNT_HILICHURLS_EQUIPMENT_COST_TRIGGER = 499
@DVA_HUNT_HILICHURLS_EQUIPMENT_COST_EFFECT = -500
#风龙领骚乱
DVA_mass_of_dvalin_category = {
	
	#第一阶段-清剿魔物

	#悬赏北部丘丘人
	DVA_post_a_reward_of_hilichurls_in_the_northern_countryside = {

		icon = generic_oppression
		
		available = {
			has_completed_focus = DVA_Deal_With_Mass_Of_Dvalin
			has_country_flag = DVA_northern_hilichurls
			NOT = {
				has_country_flag = DVA_maintaining
			}
			divisions_in_state = {
				state = 62
				size > 4
			}
		}

		highlight_states = {
			highlight_state_targets = {
				state = 62
			}
		}

		cost = 0

		ai_will_do = {
			factor = 0
			modifier = {
				add = 200
				divisions_in_state = {
					state = 62	
					size > 4
				}
			}
		}

		visible = {
			NOT = { has_active_mission = DVA_maintain_stability_of_northern_region }
			has_country_flag = DVA_northern_hilichurls
		}

		fire_only_once = yes

		complete_effect = {
			set_country_flag = DVA_maintaining
			activate_mission = DVA_maintain_stability_of_northern_region
		}
	}

	#清剿北部丘丘人
	DVA_hunt_down_northern_hilichurls = {

		icon = generic_oppression

		available = {
			has_completed_focus = DVA_Deal_With_Mass_Of_Dvalin
			has_equipment = { infantry_equipment > @DVA_HUNT_HILICHURLS_EQUIPMENT_COST_TRIGGER }
			has_country_flag = DVA_northern_hilichurls
			NOT = {
				has_country_flag = DVA_maintaining
			}
			divisions_in_state = {
				state = 62
				size > 4
			}
		}

		days_remove = 15

		cancel_trigger = {
			divisions_in_state = {
				state = 62
				size < 5
			}
			has_country_flag = DVA_weapon_unreceived
		}

		highlight_states = {
			highlight_state_targets = {
				state = 62
			} 
		}
		visible = {
			has_country_flag = DVA_northern_hilichurls
		}

		fire_only_once = yes

		ai_will_do = {
			factor = 0
			modifier = {
				add = 200
				divisions_in_state = {
					state = 62	
					size < 5
				}
			}
		}

		is_good = yes

		complete_effect = {		
			MOT = {
				country_event = dva.2
			}
			set_country_flag = DVA_maintaining
			activate_mission = DVA_maintain_stability_of_northern_region
			custom_effect_tooltip = DVA_hunt_down_northern_hilichurls_mission_explanation
			set_variable = {
				var = DVA_puppet_influence
				value = 0
			}
		}

		remove_effect = {
			army_experience = 10
			if = {
				limit = {
					has_country_flag = DVA_weapon_received
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = @DVA_HUNT_HILICHURLS_EQUIPMENT_COST_EFFECT
				}
				add_days_mission_timeout = {
					mission = DVA_maintain_stability_of_northern_region
					days = -90
				}
				add_to_variable = {
					var = DVA_puppet_influence
					value = 1
					tooltip = add_1_to_DVA_puppet_influence_tt
				}
			}
			else = {
				add_manpower = -1000
				add_political_power = -25
				add_stability = -0.025
				add_days_mission_timeout = {
					mission = DVA_maintain_stability_of_northern_region
					days = -30
				}
			}
		}
	}

	#维稳北部地区
	DVA_maintain_stability_of_northern_region = {

		icon = generic_ignite_civil_war

		available = {
			NOT = {
				has_country_flag = DVA_northern_hilichurls
			}
		}

		days_mission_timeout = 180

		fire_only_once = yes

		activation = {
			#
		}

		visible = {
			has_country_flag = DVA_northern_hilichurls
		}

		cancel_trigger = {
			divisions_in_state = {
				state = 62
				size < 5
			}
		}

		highlight_states = {
			highlight_state_targets = {
				state = 62
			} 
		}

		is_good = yes

		timeout_effect = {
			clr_country_flag = DVA_maintaining
			clr_country_flag = DVA_northern_hilichurls
		}
	}
	#征兆北部民兵
	DVA_recruit_militia_north = {
		icon = generic_civil_support

		available = {
			NOT = { has_country_flag = DVA_northern_hilichurls }
			has_equipment = { infantry_equipment > @DVA_HUNT_HILICHURLS_EQUIPMENT_COST_TRIGGER }
		}

		visible = {
			NOT = { has_country_flag = DVA_northern_hilichurls }
		}

		ai_will_do = {
			factor = 10
		}

		fire_only_once = no

		cost = 50

		days_re_enable = 30

		complete_effect = {
			if = {
				limit = {
					not = {
						has_country_flag = DVA_militia_recruited
					}
				}
				division_template = {
					name = "风龙领民兵"
					
					regiments = {
						militia = { x = 0 y = 0 }
						militia = { x = 0 y = 1 }
						militia = { x = 0 y = 2 }
						militia = { x = 0 y = 3 }
						militia = { x = 0 y = 4 }
					}
					support = {
						#
					}
					priority = 1
					is_locked = yes
					allow_new_equipment=yes
					allow_foreign_equipment=yes
				}
				set_country_flag = DVA_militia_recruited
			}
			random_owned_controlled_state = {
				limit = { ROOT = { has_full_control_of_state = PREV } }
				prioritize = { 62 }
				create_unit = {
					division = "name = \"1. 风龙领民兵西风山支队\" division_template = \"风龙领民兵\" start_experience_factor = 0.5" 
					owner = DVA
				}
			}
		}
	}
	#解放民兵
	DVA_release_militia = {
		icon = generic_civil_support

		available = {
			
		}
		visible = {
			has_country_flag = DVA_militia_recruited
		}
		ai_will_do = {
			base = 10
			modifier = {
				NOT = {
					has_war = yes
				}
				factor = 10
			}
		}
		cost = 0
		
		complete_effect = {
			if = {
				limit = {
					num_battalions_in_states = {
						count > 10
						states = { 57 58 59 60 61 62 }
						exclude = { militia }
					}
				}
				add_manpower = 50000
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 5000
				}
				army_experience = 250
				add_stability = 0.1
			}
			else = {
				add_manpower = 10000
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 1000
				}
				army_experience = 50
			}
			delete_unit_template_and_units = { division_template = "风龙领民兵" }
			clr_country_flag = DVA_militia_recruited
		}
	}

	#第二阶段-保境安民，震慑宵小

	#驱逐愚人众先遣队
	DVA_drive_off_Fatui_Skirmisher = {

		icon = generic_oppression
		
		available = {
			NOT = { has_country_flag = DVA_northern_hilichurls }
		}
		visible = {
			NOT = { has_country_flag = DVA_northern_hilichurls }
		}

		highlight_states = {
			highlight_state_targets = {
				state = 58
			}
		}

		cost = 0

		days_remove = 7
		days_re_enable = 30

		ai_will_do = {
			base = 10
			modifier = { 
				has_war = no
				factor = 10
			}
		}

		remove_effect = {
			start_border_war = {
				change_state_after_war = no
				attacker = {
					state = 62
					num_provinces = 2
					on_win = dva_border_conflict.1
					on_lose = dva_border_conflict.2
					on_cancel = dva_border_conflict.3
					modifier = 0.1
					dig_in_factor = 0
					terrain_factor = 0
				}	
				defender = {
					state = 62
					num_provinces = 2
					on_win = dva_border_conflict.2
					on_lose = dva_border_conflict.1
					on_cancel = dva_border_conflict.3
				}
			}
		}
	}
	#镇压各路盗匪
	DVA_pacify_bandits_anywhere = {

		icon = generic_oppression
		
		available = {
			57 = {
				is_controlled_by = ROOT
			}
			58 = {
				is_controlled_by = ROOT
			}
			59 = {
				is_controlled_by = ROOT
			}
			60 = {
				is_controlled_by = ROOT
			}
			61 = {
				is_controlled_by = ROOT
			}
			62 = {
				is_controlled_by = ROOT
			}
			NOT = { has_country_flag = DVA_northern_hilichurls }
			divisions_in_state = {
				state = 57
				size > 0
			}
			divisions_in_state = {
				state = 58
				size > 0
			}
			divisions_in_state = {
				state = 59
				size > 0
			}
			divisions_in_state = {
				state = 60
				size > 0
			}
			divisions_in_state = {
				state = 61
				size > 0
			}
			divisions_in_state = {
				state = 62
				size > 0
			}
		}

		visible = {
			NOT = { has_country_flag = DVA_northern_hilichurls }
		}

		cost = 0

		ai_will_do = {
			factor = 0
			modifier = {
				add = 200
				divisions_in_state = {
					state = 57	
					size > 0
				}
				divisions_in_state = {
					state = 58	
					size > 0
				}
				divisions_in_state = {
					state = 59	
					size > 0
				}
				divisions_in_state = {
					state = 60	
					size > 0
				}
				divisions_in_state = {
					state = 61	
					size > 0
				}
				divisions_in_state = {
					state = 62	
					size > 0
				}
			}
		}

		fire_only_once = yes

		complete_effect = {
			clr_country_flag = DVA_dvalin_mass_flag
		}
	}
}

#火种计划
DVA_helios_project_category = {
	#哄骗骑士团投资
	DVA_cheating_Knights_into_investing = {

		icon = generic_oppression
		
		available = {
			has_country_flag = DVA_helios_project_flag
		}

		cost = 0

		days_remove = 15
		days_re_enable = 120

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
		}
		

		fire_only_once = yes

		complete_effect = {		
			MOT = {
				country_event = dva.ab.37
			}
		}

		remove_effect = {
			if = {
				limit = {
					has_country_flag = DVA_budget_passed
				}
				add_to_variable = {
					var = DVA_helios_project_fund
					value = 1
					tooltip = increase_DVA_helios_project_fund_tt
				}
			}
			if = {
				limit = {
					check_variable = { DVA_helios_project_fund > 0 }
				}
				set_country_flag = DVA_budget_enough
			}
			if = {
				limit = {
					check_variable = { DVA_helios_project_fund = 0 }
				}
				clr_country_flag = DVA_budget_enough
			}
		}
	}
	#投资我们的计划
	DVA_invest_our_plan = {

		icon = generic_oppression
		
		available = {
			has_country_flag = DVA_helios_project_flag
		}

		cost = 25

		days_remove = 120
		days_re_enable = 7

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
		}
		

		fire_only_once = yes

		modifier = {
			civilian_factory_use = 3
		}

		complete_effect = {		
			add_to_variable = {
				var = DVA_helios_project_fund
				value = 1
				tooltip = increase_DVA_helios_project_fund_tt
			}
		}

		remove_effect = {
			if = {
				limit = {
					check_variable = { DVA_helios_project_fund > 0 }
				}
				set_country_flag = DVA_budget_enough
			}
			if = {
				limit = {
					check_variable = { DVA_helios_project_fund = 0 }
				}
				clr_country_flag = DVA_budget_enough
			}
		}
	}
	#招募学者进行研究
	DVA_recruit_scholars = {

		icon = generic_oppression
		
		available = {
			has_country_flag = DVA_helios_project_flag
		}

		cost = 50

		days_re_enable = 30

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
			NOT = {
				has_country_flag = DVA_helios_project_first_step_flag
			}
		}

		fire_only_once = yes

		complete_effect = {
			add_to_variable = {
				var = DVA_helios_project_fund
				value = -1
				tooltip = decrease_DVA_recruit_scholars_fund_tt
			}
			add_to_variable = {
				var = DVA_helios_project_preparation_step_progress
				value = 10
				tooltip = increase_DVA_helios_project_preparation_step_progress_tt
			}
			add_manpower = -10
		}
	}
	#进行下一阶段
	DVA_carry_on_next_step = {

		icon = generic_oppression
		
		available = {
			has_country_flag = DVA_helios_project_flag
		}

		cost = 0

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
			NOT = {
				has_country_flag = DVA_helios_project_first_step_flag
			}
		}

		fire_only_once = yes

		complete_effect = {
			set_country_flag = DVA_helios_project_first_step_flag
		}
	}
	#制造火箭零件
	DVA_manufacturing_rocket_parts = {

		icon = generic_oppression
		
		available = {
			always = no
		}

		cost = 0

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
			has_country_flag = DVA_helios_project_first_step_flag
		}

		fire_only_once = yes

		complete_effect = {
			#
		}
	}
	#组装火箭
	DVA_assembling_rocket = {

		icon = generic_oppression
		
		available = {
			always = no
		}

		cost = 0

		ai_will_do = {
			base = 100
		}

		visible = {
			has_country_flag = DVA_helios_project_flag
			has_country_flag = DVA_helios_project_first_step_flag
		}

		fire_only_once = yes

		complete_effect = {
			#
		}
	}
	#启程之日，触发事件“倒计时”
}

#神灵的注视
DVA_stare_of_archon = {
	DVA_approaching_of_the_end = {

		icon = generic_civil_support

		available = {
			NOT = { has_idea = DVA_powerless_government }
		}

		days_mission_timeout = 720

		activation = {
			has_idea = DVA_powerless_government
			always = no
		}

		visible = {
			has_idea = DVA_powerless_government
		}

		fire_only_once = yes

		is_good = no

		timeout_effect = {
			random_list = {
				25 = {
					country_event = dva.vt.1
				}
				25 = {
					country_event = dva.vt.2
				}
				25 = {
					country_event = dva.vt.3
				}
				25 = {
					
				}
			}
		}
	}
}